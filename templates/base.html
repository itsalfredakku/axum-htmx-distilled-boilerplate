<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="referrer" content="no-referrer">
    <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
    <title>{% block title %}Axum HTMX App{% endblock %}</title>

    <!-- Design System Tokens -->
    {% include "components/_tokens.html" %}

    <!-- Vendored CSS — no external CDN, no remote fonts -->
    <link href="/static/css/app.css" rel="stylesheet">
    <!-- Vendored icons — served from local fonts/ directory -->
    <link href="/static/css/bootstrap-icons.min.css" rel="stylesheet">

    <style>
        html, body { height: 100%; overflow: hidden; }

        .app-wrapper { display: flex; height: 100vh; overflow: hidden; }

        /* Sidebar */
        .sidebar {
            width: 250px; min-width: 250px; height: 100vh;
            display: flex; flex-direction: column;
            background: var(--color-background);
            border-right: 1px solid var(--color-border);
            transition: width 0.3s, min-width 0.3s;
        }
        .sidebar.collapsed { width: 64px; min-width: 64px; }
        .sidebar-header {
            padding: var(--space-4); border-bottom: 1px solid var(--color-border);
            display: flex; align-items: center; gap: var(--space-3);
        }
        .sidebar-brand {
            display: flex; align-items: center; gap: var(--space-3);
            text-decoration: none; color: inherit; font-weight: 700; font-size: var(--font-size-lg);
        }
        .sidebar-brand i { font-size: 1.5rem; color: var(--color-brand); line-height: 1; }
        .sidebar-nav { flex: 1; overflow-y: auto; padding: var(--space-2); }
        .sidebar .nav-link {
            display: flex; align-items: center; gap: var(--space-3);
            padding: var(--space-3) var(--space-4); margin-bottom: var(--space-1);
            border-radius: var(--radius-md); color: var(--color-foreground-muted);
            text-decoration: none; font-weight: 500;
            transition: all var(--duration-fast);
        }
        .sidebar .nav-link:hover { background: var(--color-background-muted); color: var(--color-foreground); }
        .sidebar .nav-link.active { background: var(--color-brand); color: white; }
        .sidebar .nav-link i { width: 1.25rem; text-align: center; flex-shrink: 0; font-size: 1rem; line-height: 1; }
        .sidebar.collapsed .nav-text { display: none; }
        .sidebar.collapsed .nav-link { justify-content: center; padding: var(--space-3); }
        .sidebar.collapsed .brand-text { display: none; }

        /* Main content */
        .main-wrapper { flex: 1; display: flex; flex-direction: column; overflow: hidden; min-width: 0; }
        .main-header {
            height: 56px; min-height: 56px;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 var(--space-4);
            background: var(--color-background);
            border-bottom: 1px solid var(--color-border);
        }
        .main-content { flex: 1; overflow-y: auto; padding: var(--space-6); background: var(--color-background-subtle); }

        /* Stat cards */
        .stat-card { padding: var(--space-4); }

        /* HTMX loading indicator */
        .htmx-indicator { opacity: 0; transition: opacity 0.2s; }
        .htmx-request .htmx-indicator, .htmx-request.htmx-indicator { opacity: 1; }

        /* Skeleton loading */
        .skeleton { background: var(--color-background-muted); border-radius: var(--radius-sm); animation: pulse 2s infinite; }
        .skeleton-text { height: 1rem; width: 60%; }
        @keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:.5; } }

        /* Error toast area */
        #error-toast:empty { display: none; }
        #error-toast { position: fixed; top: var(--space-4); right: var(--space-4); z-index: 1000; max-width: 400px; }

        /* Theme icons — only show the active one */
        [data-theme="light"] .theme-icon-dark { display: none; }
        [data-theme="dark"] .theme-icon-light { display: none; }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar { display: none; }
            .main-content { padding: var(--space-4); }
        }
    </style>

    <!--
        HTMX — the ONLY JavaScript loaded. Vendored, SRI-pinned.
        If the hash doesn't match, the browser refuses to execute it.
    -->
    <script src="/static/js/htmx.min.js"
            integrity="sha384-HGfztofotfshcF7+8n44JQL2oJmowVChPTg48S+jvZoztPfvwD79OC/LTtG6dMp+"
            crossorigin="anonymous"></script>

    {% block head %}{% endblock %}
</head>
<!--
    HTMX: automatically send CSRF token on every request.
    The token is injected by the session middleware as a response header.
    HTMX reads it from the meta tag and attaches it to all requests.
-->
<body hx-headers='{"X-CSRF-Token": "{{ csrf_token }}"}'>
    <!-- Error toast container (HTMX errors swap here) -->
    <div id="error-toast"></div>

    <div class="app-wrapper">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <a href="/" class="sidebar-brand" hx-boost="true" hx-target="#page-content" hx-select="#page-content" hx-swap="outerHTML" hx-push-url="true">
                    <i class="bi bi-shield-lock-fill"></i>
                    <span class="brand-text">Hardened App</span>
                </a>
            </div>
            <nav class="sidebar-nav" hx-boost="true" hx-target="#page-content" hx-select="#page-content" hx-swap="outerHTML" hx-push-url="true">
                <a href="/" class="nav-link {% if current_page == "home" %}active{% endif %}">
                    <i class="bi bi-house"></i><span class="nav-text">Home</span>
                </a>
                <a href="/demo" class="nav-link {% if current_page == "demo" %}active{% endif %}">
                    <i class="bi bi-lightning"></i><span class="nav-text">Demo</span>
                </a>
                <a href="/about" class="nav-link {% if current_page == "about" %}active{% endif %}">
                    <i class="bi bi-info-circle"></i><span class="nav-text">About</span>
                </a>
            </nav>
        </aside>

        <!-- Main -->
        <div class="main-wrapper">
            <header class="main-header">
                <div style="display:flex;align-items:center;gap:var(--space-2)">
                    <button class="btn btn-light btn-sm" id="sidebar-toggle" style="width:36px;height:36px;">
                        <i class="bi bi-list"></i>
                    </button>
                </div>
                <div>
                    <button class="btn btn-light btn-sm" id="theme-toggle" title="Toggle theme" style="width:36px;height:36px;">
                        <i class="bi bi-sun-fill theme-icon-light"></i>
                        <i class="bi bi-moon-fill theme-icon-dark"></i>
                    </button>
                </div>
            </header>
            <main class="main-content" id="main-content">
                <div id="page-content">
                    {% block content %}{% endblock %}
                </div>
            </main>
        </div>
    </div>

    {% block scripts %}{% endblock %}

    <!-- Minimal UI interactions — sidebar, theme, CSRF refresh. Fully auditable. -->
    <script src="/static/js/app.js"
            integrity="sha384-yYlvqbxhKBZIj2+YCRfQaLIi2w6Co6aRsVvsgD/gdiBz0wl/RYpScFKQO5eNiolY"
            crossorigin="anonymous"></script>
</body>
</html>
